{% extends "base_template.html" %} {% block body %}
    <p><span class="font-weight-bold">Codice Votazione:</span> {{v.votation_id}}</p>
    <p><span class="font-weight-bold">Tipo Votazione:</span> {{type_description[v.votation_type]}}</p>
    <p><span class="font-weight-bold">Descrizione:</span> {{v.votation_description}}</p>
    <p><span class="font-weight-bold">Stato:</span> {{states[v.votation_status]}} ({{v.votation_status}})</p>
    <p><span class="font-weight-bold">Avviata da:</span> {{v.promoter_user.user_name}}</p>
    <div class="container">
        {% if votation_timing == -1 %}
        <p class="font-weight-bold">La votazione non è ancora iniziata.</p>
        <p><span class="font-weight-bold">Inizio previsto per:</span> {{v.begin_date}} {{v.begin_time}}</p>
        <p><span class="font-weight-bold">Terminere previsto per:</span> {{v.end_date}} {{v.end_time}}</p>    
        {% endif %}
        {% if votation_timing == +1 %}
        <p class="font-weight-bold">La votazione è terminata.</p>
        <p><span class="font-weight-bold">Iniziata il:</span> {{v.begin_date}} {{v.begin_time}}</p>
        <p><span class="font-weight-bold">Terminata il:</span> {{v.end_date}} {{v.end_time}}</p>
        {% endif %}
        {% if votation_timing == 0 %}
        <p class="font-weight-bold">La votazione è in corso.</p>
        <p><span class="font-weight-bold">Iniziata il:</span> {{v.begin_date}} {{v.begin_time}}</p>
        <p><span class="font-weight-bold">Terminerà il:</span> {{v.end_date}} {{v.end_time}}</p>    
        {% endif %}
    </div>
    <p><span class="font-weight-bold">Votanti :</span> {{count_voters}}</p>
    <p><span class="font-weight-bold">Voti :</span> {{count_votes}}</p>

    {% if v.votation_type == "maj_jud" or v.votation_type == "maj_jud_sec"  %}
        {% if current_user.u.user_id == v.promoter_user.user_id and votation_timing == +1 and v.votation_status ==1 %}
            <p><a class="btn btn-warning" href="/close_election/{{v.votation_id}}">Termina l'elezione</a></p>
        {% endif %}
    {% endif %}


    {% if v.votation_type == "draw" %}
        {% if current_user.u.user_id == v.promoter_user.user_id and v.votation_status == 0 and candidates_array|length > 0  %}
            <p><a href="/start_election/{{v.votation_id}}">Inizia l'elezione</a></p>
        {% endif %}
    <h3>Candidati:</h3>
    <ul>
        {% for c in candidates_array %}
            <li  ><span >{{c.u.user_name}}</span> [Candidato n. {{c.order_n}}]</li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if v.votation_type == "maj_jud" or v.votation_type == "maj_jud_sec"  %}
    <h3>Opzioni:</h3>
    <ul>
        {% for c in options_array %}
            <li>{{c.option_name}}</li>
        {% endfor %}
    </ul>
    {% endif %}

    
    {% if v.votation_status == 4 %}
        <h3>Risultato della votazione</h3>
        <div>The election is failed.</div>
    {% endif %}
    {% if v.votation_status == 3 %}
        <h3>Risultato della votazione</h3>
        {% if count_voters == count_votes %}
            <div class="alert alert-success">Il numero di voti è coerente con il numero di votanti.</div>
        {% else %}
            <div class="alert alert-danger">Il numero di voti  non è coerente con il numero di votanti.</div>
        {% endif %}
        <h4>Classifica</h4>
        <div class="container">
            <ol>
                {% for r in counting %}
                    <li class="mb-1">
                        {{r.option_name}}
                        <div class="row">
                            {% for i in range(words|count) %} 
                                <div class="col-sm border text-nowrap ml-1 mb-1"><span class="badge badge-pill badge-warning w-25">{{r.totals_array[i]}}</span> {{words[i]}}</div>                                                  
                            {% endfor %}
                        </div> 
                    </li>
                {% endfor %}
            </ol>
        </div>
        <h4>Grafico</h4>
        <div id="chart_div"></div>

        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script type="text/javascript">
    
          // Load the Visualization API and the corechart package.
          google.charts.load('current', {'packages':['corechart']});
    
          // Set a callback to run when the Google Visualization API is loaded.
          google.charts.setOnLoadCallback(drawChart);
    
          // Callback that creates and populates a data table,
          // instantiates the pie chart, passes in the data and
          // draws it.
          function drawChart() {
    
            var data = google.visualization.arrayToDataTable([
            [ "Giudizio",
            {% for w in words %}"{{w}}", {% endfor %}
            { role: 'annotation' } ],
            {% for r in counting %}
                ["{{r.option_name}}",
                {% for n in r.totals_array %}{{n}}, {% endfor %}
                ''],           
            {% endfor %}
          ]);
    
          var options = {
            width: 600,
            height: 400,
            legend: { position: 'top', maxLines: 3 },
            bar: { groupWidth: '75%' },
            isStacked: true
          };
    
            // Instantiate and draw our chart, passing in some options.
            var chart = new google.visualization.BarChart(document.getElementById('chart_div'));
            chart.draw(data, options);
          }
        </script>




    {% endif %}
{% endblock %}
