{% extends "base_template.html" %} {% block body %}
    <div><h4>{{v.votation_description}}</h4></div>
    {% if  v.votation_status == 0 %}
        <p>You cannot vote yet.</p>
    {% endif %}
    {% if  v.votation_status > 1 %}
        <p>You cannot vote anymore.</p>
    {% endif %}
    {% if  v.votation_status == 1 %}
        <form action="/vote/{{v.votation_id}}" method="POST" id="vote_form">
            Choose only one option:
            {% for o in options_array %}
            <div class="form-check ">
                <input class="form-check-input" type="radio" data-cy='radio'
                name="my_vote" id="v_{{o.option_id}}" value="{{o.option_id}}"  />
                <label class="form-check-label" for="v_{{o.option_id}}">{{o.option_name}}</label>
            </div>
            {% endfor %}

            <div class="form-group">
                <label for="secret_key_{{v.votation_id}}">Password for this vote:</label>
                <input type="password" id="secret_key_{{v.votation_id}}" name="secret_key_{{v.votation_id}}" autocomplete="off" data-cy="password" />
                <small class="form-text text-muted">Remember this password; it isn't possible to recover it</small>
            </div>
        <button class="btn btn-warning" type="submit" id="sub_button">Vote</button>
        <input type="hidden" id="vote_key" name="vote_key" value="xxx"  />
    </form>
    {% endif %}


<script src="https://cdn.jsdelivr.net/npm/node-forge@0.7.0/dist/forge.min.js"></script>
<script>

    $("#vote_form").submit(function( event ){
        var pass_word = $("#secret_key_{{v.votation_id}}").val().trim();
        if (!pass_word) {
            alert("You must enter a password");
            return false;
        }
        var md = forge.md.sha256.create();
        var vote_key = "{{current_user.u.user_id}}-" + "{{v.votation_id}}-" + $("#secret_key_{{v.votation_id}}").val();
        md.update(vote_key);
        console.log("vote_key " + vote_key);
        $("#vote_key").val(md.digest().toHex());
        return true;
    });

</script>

{% endblock %}
